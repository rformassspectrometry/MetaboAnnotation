<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Representation of Spectra matches — MatchedSpectra • MetaboAnnotation</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Representation of Spectra matches — MatchedSpectra"><meta name="description" content="Matches between query and target spectra can be represented by the
MatchedSpectra object. Functions like the matchSpectra() function will
return this type of object. By default, all data accessors work as
left joins between the query and the target spectra, i.e. values are
returned for each query spectrum with eventual duplicated entries (values)
if the query spectrum matches more than one target spectrum."><meta property="og:description" content="Matches between query and target spectra can be represented by the
MatchedSpectra object. Functions like the matchSpectra() function will
return this type of object. By default, all data accessors work as
left joins between the query and the target spectra, i.e. values are
returned for each query spectrum with eventual duplicated entries (values)
if the query spectrum matches more than one target spectrum."><meta property="og:image" content="https://rformassspectrometry.github.io/MetaboAnnotation/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MetaboAnnotation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.11.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MetaboAnnotation.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/MetaboAnnotation/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Representation of Spectra matches</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/MetaboAnnotation/blob/main/R/MatchedSpectra.R" class="external-link"><code>R/MatchedSpectra.R</code></a></small>
      <div class="d-none name"><code>MatchedSpectra.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Matches between query and target spectra can be represented by the
<code>MatchedSpectra</code> object. Functions like the <code><a href="matchSpectra.html">matchSpectra()</a></code> function will
return this type of object. By default, all data accessors work as
<em>left joins</em> between the <em>query</em> and the <em>target</em> spectra, i.e. values are
returned for each <em>query</em> spectrum with eventual duplicated entries (values)
if the query spectrum matches more than one target spectrum.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">MatchedSpectra</span><span class="op">(</span></span>
<span>  query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  matches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>query_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>, target_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>, score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MatchedSpectra'</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MatchedSpectra'</span></span>
<span><span class="fu"><a href="Matched.html">queryVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MatchedSpectra'</span></span>
<span><span class="fu"><a href="Matched.html">targetVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MatchedSpectra'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MatchedSpectra'</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">name</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MatchedSpectra'</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MatchedSpectra'</span></span>
<span><span class="fu"><a href="Matched.html">matchedData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MatchedSpectra'</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">addProcessing</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">FUN</span>, <span class="va">...</span>, spectraVariables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MatchedSpectra'</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectra-plotting.html" class="external-link">plotSpectraMirror</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"m/z"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"intensity"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">""</span>,</span>
<span>  scalePeaks <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MatchedSpectra,MsBackend'</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">setBackend</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">backend</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-query">query<a class="anchor" aria-label="anchor" href="#arg-query"></a></dt>
<dd><p><code>Spectra</code> with the query spectra.</p></dd>


<dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p><code>Spectra</code> with the spectra against which <code>query</code> has been
matched.</p></dd>


<dt id="arg-matches">matches<a class="anchor" aria-label="anchor" href="#arg-matches"></a></dt>
<dd><p><code>data.frame</code> with columns <code>"query_idx"</code> (<code>integer</code>),
<code>"target_idx"</code> (<code>integer</code>) and <code>"score"</code> (<code>numeric</code>) representing the
<em>n:m</em> mapping of elements between the <code>query</code> and the <code>target</code> <code>Spectra</code>.</p></dd>


<dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p><code>MatchedSpectra</code> object.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p><code>MatchedSpectra</code> object.</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>for <code>$</code>: the name of the spectra variable to extract.</p></dd>


<dt id="arg-columns">columns<a class="anchor" aria-label="anchor" href="#arg-columns"></a></dt>
<dd><p>for <code>spectraData</code>: <code>character</code> vector with spectra variable
names that should be extracted.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>for <code>addProcessing</code>: additional parameters for the function <code>FUN</code>.
For <code>plotSpectraMirror</code>: additional parameters passed to the plotting
functions.</p></dd>


<dt id="arg-fun">FUN<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>for <code>addProcessing</code>: function to be applied to the peak matrix
of each spectrum in <code>object</code>. See <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> for more details.</p></dd>


<dt id="arg-spectravariables">spectraVariables<a class="anchor" aria-label="anchor" href="#arg-spectravariables"></a></dt>
<dd><p>for <code>addProcessing</code>: <code>character</code> with additional
spectra variables that should be passed along to the function defined
with <code>FUN</code>. See <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> for details.</p></dd>


<dt id="arg-xlab">xlab<a class="anchor" aria-label="anchor" href="#arg-xlab"></a></dt>
<dd><p>for <code>plotSpectraMirror</code>: the label for the x-axis.</p></dd>


<dt id="arg-ylab">ylab<a class="anchor" aria-label="anchor" href="#arg-ylab"></a></dt>
<dd><p>for <code>plotSpectraMirror</code>: the label for the y-axis.</p></dd>


<dt id="arg-main">main<a class="anchor" aria-label="anchor" href="#arg-main"></a></dt>
<dd><p>for <code>plotSpectraMirror</code>: an optional title for each plot.</p></dd>


<dt id="arg-scalepeaks">scalePeaks<a class="anchor" aria-label="anchor" href="#arg-scalepeaks"></a></dt>
<dd><p>for <code>plotSpectraMirror</code>: <code>logical(1)</code> if peak intensities
(per spectrum) should be scaled to a total sum of one (per spectrum) prior
to plotting.</p></dd>


<dt id="arg-backend">backend<a class="anchor" aria-label="anchor" href="#arg-backend"></a></dt>
<dd><p>for <code>setBackend</code>: instance of an object extending
<a href="https://rdrr.io/pkg/Spectra/man/MsBackend.html" class="external-link">Spectra::MsBackend</a>. See help for <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::setBackend()</a></code>
for more details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>See individual method desciption above for details.</p>
    </div>
    <div class="section level2">
    <h2 id="creation-subset-and-filtering">Creation, subset and filtering<a class="anchor" aria-label="anchor" href="#creation-subset-and-filtering"></a></h2>



<p><code>MatchedSpectra</code> objects are the result object from the <code><a href="matchSpectra.html">matchSpectra()</a></code>.
While generally not needed, <code>MatchedSpectra</code> objects can also be created
with the <code>MatchedSpectra</code> function providing the <code>query</code> and <code>target</code>
<code>Spectra</code> objects as well as a <code>data.frame</code> with the <em>matches</em> between
query and target elements. This data frame is expected to have columns
<code>"query_idx"</code>, <code>"target_idx"</code> with the <code>integer</code> indices of query and
target objects that are <em>matched</em> and a column <code>"score"</code> with a <code>numeric</code>
score for the match.</p>
<p><code>MatchedSpectra</code> objects can be subset using:</p><ul><li><p><code>[</code> subset the <code>MatchedSpectra</code> selecting <code>query</code> spectra to keep with
parameter <code>i</code>. The <code>target</code> spectra will by default be returned as-is.</p></li>
<li><p><code>pruneTarget</code> <em>cleans</em> the <code>MatchedSpectra</code> object by removing non-matched
target spectra.</p></li>
</ul><p>In addition, <code>MatchedSpectra</code> can be filtered with any of the filtering
approaches defined for <code><a href="Matched.html">Matched()</a></code> objects: <code><a href="Matched.html">SelectMatchesParam()</a></code>,
<code><a href="Matched.html">TopRankedMatchesParam()</a></code> or <code><a href="Matched.html">ScoreThresholdParam()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="extracting-data">Extracting data<a class="anchor" aria-label="anchor" href="#extracting-data"></a></h2>


<ul><li><p><code>$</code> extracts a single spectra variable from the <code>MatchedSpectra</code> <code>x</code>. Use
<code>spectraVariables</code> to get all available spectra variables. Prefix
<code>"target_"</code> is used for spectra variables from the <em>target</em> <code>Spectra</code>. The
matching scores are available as <em>spectra variable</em> <code>"score"</code>.
Similar to a left join between the query and target spectra, this function
returns a value for each query spectrum with eventual duplicated values for
query spectra matching more than one target spectrum. If spectra variables
from the target spectra are extracted, an <code>NA</code> is reported for <em>query</em>
spectra that don't match any target spectra. See examples below for more
details.</p></li>
<li><p><code>length</code> returns the number of <strong>query</strong> spectra.</p></li>
<li><p><code>matchedData</code> same as <code>spectraData</code> below.</p></li>
<li><p><code>query</code> returns the <em>query</em> <code>Spectra</code>.</p></li>
<li><p><code>queryVariables</code> returns the <code>spectraVariables</code> of <em>query</em>.</p></li>
<li><p><code>spectraData</code> returns spectra variables from the query and/or target
<code>Spectra</code> as a <code>DataFrame</code>. Parameter <code>columns</code> allows to define which
variables should be returned (defaults to
<code>columns = spectraVariables(object)</code>), spectra variable names of the target
spectra need to be prefixed with <code>target_</code> (e.g. <code>target_msLevel</code> to get
the MS level from target spectra). The score from the matching function is
returned as spectra variable <code>"score"</code>. Similar to <code>$</code>, this function
performs a <em>left join</em> of spectra variables from the <em>query</em> and <em>target</em>
spectra returning all values for all query spectra (eventually returning
duplicated elements for query spectra matching multiple target spectra)
and the values for the target spectra matched to the respective query
spectra. See help on <code>$</code> above or examples below for details.</p></li>
<li><p><code>spectraVariables</code> returns all available spectra variables in the <em>query</em>
and <em>target</em> spectra. The prefix <code>"target_"</code> is used to label spectra
variables of target spectra (e.g. the name of the spectra variable for the
MS level of target spectra is called <code>"target_msLevel"</code>).</p></li>
<li><p><code>target</code> returns the <em>target</em> <code>Spectra</code>.</p></li>
<li><p><code>targetVariables</code> returns the <code>spectraVariables</code> of <em>target</em> (prefixed
with <code>"target_"</code>).</p></li>
<li><p><code>whichTarget</code> returns an <code>integer</code> with the indices of the spectra in
<em>target</em> that match at least on spectrum in <em>query</em>.</p></li>
<li><p><code>whichQuery</code> returns an <code>integer</code> with the indices of the spectra in
<em>query</em> that match at least on spectrum in <em>target</em>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="data-manipulation-and-plotting">Data manipulation and plotting<a class="anchor" aria-label="anchor" href="#data-manipulation-and-plotting"></a></h2>


<ul><li><p><code>addProcessing</code>: add a processing step to both the <em>query</em> and <em>target</em>
<code>Spectra</code> in <code>object</code>. Additional parameters for <code>FUN</code> can be passed <em>via</em>
<code>...</code>. See <code>addProcessing</code> documentation in <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> for more
information.</p></li>
<li><p><code>plotSpectraMirror</code>: creates a mirror plot between the query and each
matching target spectrum. Can only be applied to a <code>MatchedSpectra</code> with a
single query spectrum. Setting parameter <code>scalePeaks = TRUE</code> will scale
the peak intensities per spectrum to a total sum of one for a better
graphical visualization. Additional plotting parameters can be passed
through <code>...</code>.</p></li>
<li><p><code>setBackend</code>: allows to change the <em>backend</em> of both the query and target
<code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> object. The function will return a <code>MatchedSpectra</code>
object with the query and target <code>Spectra</code> changed to the specified
<code>backend</code>, which can be any backend extending <a href="https://rdrr.io/pkg/Spectra/man/MsBackend.html" class="external-link">Spectra::MsBackend</a>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="Matched.html">Matched()</a></code> for additional functions available for <code>MatchedSpectra</code>.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Johannes Rainer</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Creating a dummy MatchedSpectra object.</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/Spectra" class="external-link">Spectra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    msLevel <span class="op">=</span> <span class="fl">2L</span>, rtime <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>    spectrum_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>, <span class="st">"g"</span>, <span class="st">"h"</span>, <span class="st">"i"</span>, <span class="st">"j"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    msLevel <span class="op">=</span> <span class="fl">2L</span>, rtime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    spectrum_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Define matches between query spectrum 1 with target spectra 2 and 5,</span></span></span>
<span class="r-in"><span><span class="co">## query spectrum 2 with target spectrum 2 and query spectrum 4 with target</span></span></span>
<span class="r-in"><span><span class="co">## spectra 8, 12 and 15.</span></span></span>
<span class="r-in"><span><span class="va">ms</span> <span class="op">&lt;-</span> <span class="fu">MatchedSpectra</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">sp1</span>, <span class="va">sp2</span>, matches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>query_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">1L</span>, <span class="fl">2L</span>, <span class="fl">4L</span>, <span class="fl">4L</span>, <span class="fl">4L</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   target_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">5L</span>, <span class="fl">2L</span>, <span class="fl">8L</span>, <span class="fl">12L</span>, <span class="fl">15L</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   score <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Which of the query spectra match at least one target spectrum?</span></span></span>
<span class="r-in"><span><span class="fu"><a href="Matched.html">whichQuery</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2 4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Extracting spectra variables: accessor methods for spectra variables act</span></span></span>
<span class="r-in"><span><span class="co">## as "left joins", i.e. they return a value for each query spectrum, with</span></span></span>
<span class="r-in"><span><span class="co">## eventually duplicated elements if one query spectrum matches more than</span></span></span>
<span class="r-in"><span><span class="co">## one target spectrum.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Which target spectrum matches at least one query spectrum?</span></span></span>
<span class="r-in"><span><span class="fu"><a href="Matched.html">whichTarget</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2  5  8 12 15</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Extracting the retention times of the query spectra.</span></span></span>
<span class="r-in"><span><span class="va">ms</span><span class="op">$</span><span class="va">rtime</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1  1  2  3  4  4  4  5  6  7  8  9 10</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## We have duplicated retention times for query spectrum 1 (matches 2 target</span></span></span>
<span class="r-in"><span><span class="co">## spectra) and 4 (matches 3 target spectra). The retention time is returned</span></span></span>
<span class="r-in"><span><span class="co">## for each query spectrum.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Extracting retention times of the target spectra. Note that only retention</span></span></span>
<span class="r-in"><span><span class="co">## times for target spectra matching at least one query spectrum are returned</span></span></span>
<span class="r-in"><span><span class="co">## and an NA is reported for query spectra without matching target spectrum.</span></span></span>
<span class="r-in"><span><span class="va">ms</span><span class="op">$</span><span class="va">target_rtime</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  2  5  2 NA  8  2  5 NA NA NA NA NA NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The first query spectrum matches target spectra 2 and 5, thus their</span></span></span>
<span class="r-in"><span><span class="co">## retention times are returned as well as the retention time of the second</span></span></span>
<span class="r-in"><span><span class="co">## target spectrum that matches also query spectrum 2. The 3rd query spectrum</span></span></span>
<span class="r-in"><span><span class="co">## does match any target spectrum, thus `NA` is returned. Query spectrum 4</span></span></span>
<span class="r-in"><span><span class="co">## matches target spectra 8, 12, and 15, thus the next reported retention</span></span></span>
<span class="r-in"><span><span class="co">## times are those from these 3 target spectra. None of the remaining 6 query</span></span></span>
<span class="r-in"><span><span class="co">## spectra matches any target spectra and thus `NA` is reported for each of</span></span></span>
<span class="r-in"><span><span class="co">## them.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With `queryIndex` and `targetIndex` it is possible to extract the indices</span></span></span>
<span class="r-in"><span><span class="co">## of the matched query-index pairs</span></span></span>
<span class="r-in"><span><span class="fu"><a href="Matched.html">queryIndex</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 1 2 4 4 4</span>
<span class="r-in"><span><span class="fu"><a href="Matched.html">targetIndex</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2  5  2  8 12 15</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The first match is between query index 1 and target index 2, the second</span></span></span>
<span class="r-in"><span><span class="co">## match between query index 1 and target index 5 and so on.</span></span></span>
<span class="r-in"><span><span class="co">## We could use these indices to extract a `Spectra` object containing only</span></span></span>
<span class="r-in"><span><span class="co">## matched target spectra and assign a spectra variable with the indices of</span></span></span>
<span class="r-in"><span><span class="co">## the query spectra</span></span></span>
<span class="r-in"><span><span class="va">matched_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="Matched.html">target</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="Matched.html">targetIndex</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">matched_target</span><span class="op">$</span><span class="va">query_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="Matched.html">queryIndex</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## This `Spectra` object thus contains information from the matching, but</span></span></span>
<span class="r-in"><span><span class="co">## is a *conventional* `Spectra` object that could be used for further</span></span></span>
<span class="r-in"><span><span class="co">## analyses.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## `spectraData` can be used to extract all (or selected) spectra variables</span></span></span>
<span class="r-in"><span><span class="co">## from the object. Same as with `$`, a left join between the specta</span></span></span>
<span class="r-in"><span><span class="co">## variables from the query spectra and the target spectra is performed. The</span></span></span>
<span class="r-in"><span><span class="co">## prefix `"target_"` is used to label the spectra variables from the target</span></span></span>
<span class="r-in"><span><span class="co">## spectra. Below we extract selected spectra variables from the object.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">ms</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"spectrum_id"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"target_rtime"</span>, <span class="st">"target_spectrum_id"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 13 rows and 4 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         rtime spectrum_id target_rtime target_spectrum_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;integer&gt; &lt;character&gt;    &lt;integer&gt;        &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1           a            2                  B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1           a            5                  E</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           2           b            2                  B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           3           c           NA                 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           4           d            8                  C</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...       ...         ...          ...                ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9           6           f           NA                 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10          7           g           NA                 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11          8           h           NA                 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12          9           i           NA                 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         10           j           NA                 NA</span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">spectrum_id</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "a" "a" "b" "c" "d" "d" "d" "e" "f" "g" "h" "i" "j"</span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">target_spectrum_id</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "B" "E" "B" NA  "C" "B" "E" NA  NA  NA  NA  NA  NA </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Again, all values for query spectra are returned and for query spectra not</span></span></span>
<span class="r-in"><span><span class="co">## matching any target spectrum NA is reported as value for the respecive</span></span></span>
<span class="r-in"><span><span class="co">## variable.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The example matched spectra object contains all query and all target</span></span></span>
<span class="r-in"><span><span class="co">## spectra. Below we subset the object keeping only query spectra that are</span></span></span>
<span class="r-in"><span><span class="co">## matched to at least one target spectrum.</span></span></span>
<span class="r-in"><span><span class="va">ms_sub</span> <span class="op">&lt;-</span> <span class="va">ms</span><span class="op">[</span><span class="fu"><a href="Matched.html">whichQuery</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ms_sub contains now only 3 query spectra:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">query</span><span class="op">(</span><span class="va">ms_sub</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## while the original object contains all 10 query spectra:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">query</span><span class="op">(</span><span class="va">ms</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 10</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Both object contain however still the full target `Spectra`:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="Matched.html">target</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 200</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="Matched.html">target</a></span><span class="op">(</span><span class="va">ms_sub</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 200</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With the `pruneTarget` we can however reduce also the target spectra to</span></span></span>
<span class="r-in"><span><span class="co">## only those that match at least one query spectrum</span></span></span>
<span class="r-in"><span><span class="va">ms_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="Matched.html">pruneTarget</a></span><span class="op">(</span><span class="va">ms_sub</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="Matched.html">target</a></span><span class="op">(</span><span class="va">ms_sub</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Witting, Johannes Rainer, Andrea Vicini, Carolin Huber, Philippine Louail.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

